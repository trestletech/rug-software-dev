
<style type="text/css">

.indent {
  padding-left: 2em !important;
}

.centered {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

.large {
  font-size: 1.2em !important;
  line-height: 64px !important;
}

.twitter-btn {
font: normal normal normal 12px/24px 'Helvetica Neue',Arial,sans-serif;
height: 40px;
border-radius: 4px;
max-width: 100%;
box-sizing: border-box;
position: relative;
background-color: #F8F8F8;
 
background-image: -webkit-gradient(linear,left top,left bottom,from(#FFF),to(#DEDEDE));
background-image: -moz-linear-gradient(top,#FFF,#DEDEDE);
background-image: -o-linear-gradient(top,#FFF,#DEDEDE);
background-image: -ms-linear-gradient(top,#FFF,#DEDEDE);
background-image: linear-gradient(top,#FFF,#DEDEDE);
border: #CCC solid 1px;
color: #333;
font-weight: bold;
text-shadow: 0 1px 0 rgba(255, 255, 255, .5);
-webkit-user-select: none;
-moz-user-select: none;
-o-user-select: none;
user-select: none;
cursor: pointer;
overflow: hidden;
display: inline-block;
zoom: 1;
text-decoration: none;
}
 
.twitter-btn:hover {
text-decoration: none;
}
 
.twitter-btn i {
width: 21px;
height: 16px;
left: 4px;
margin-top: -6px;
position: absolute;
top: 50%;
background: rgba(0, 0, 0, 0) url(data:image/png;base64,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) 0 0 no-repeat;
background-position: -24px 0;
}
 
.twitter-btn .label {
padding: 0 7px 0 29px;
white-space: nowrap;
}

</style>

Revision Control & Testing in R
========================================================
author: Jeff Allen
date: January 18, 2014
transition: rotate

### https://github.com/trestletech/rug-software-dev

<a target="_blank" class="twitter-btn" title="Follow @TrestleJeff on Twitter" href="https://twitter.com/TrestleJeff">
<i></i>
<span class="label">@TrestleJeff</span>
</a>

Quick Poll
==========
incremental: true

- Used revision control before (Subersion, CVS, Mercurial, Git, etc.)?
- Used Git before?
- Used automated testing before?

Revision Control
==================================
type: section

Revision Control Motivation
===========================

### "This function used to work!"
<span class="indent">Inspect provenance of any file in your project.</span>

### "Please send me the code you used here."
<span class="indent">Might be some publication from years ago.</span>

### "Let's work together!"
<span class="indent">Take turns & merge? Live update? Will have problems.</span>

### "I found a bug in your code and fixed it."

Revision Control
================

![original file](images/pia.png)
<div style="text-align: center; width: 100%;">December 1</div>
***
![modified file](images/pib.png)
<div style="text-align: center; width: 100%;">December 4</div>

Revision Control
================

- Maintain your own copy ("**working copy**") of the code. Never edit the central copy directly.
- Track changes to a set of files ("**commits**") over time with custom granularity.
- Record messages alongside each commit to record what you did.

***

![revision history](images/revisions.png)

Revision Control, Cont'd.
=========================

![network branches](images/branches.png)

***

- Revert any file -- or the whole set -- back to any point in the project's history.
- Maintain multiple versions ("**branches**") in parallel in one location ("**repository**").
- Collaborate by contributing your changes ("**commits**") to a central server.

Why Git?
========

Git is a modern, distributed revision control system.

- "Modern"
  - Learned from past implementations
  - Better branching and merging
- "[Distributed](http://hginit.com/00.html)"
  - Commit, refine, clean locally before sharing with others
  - Multi-authority -- changes to code can come from multiple sources
  - Always nice to have a copy in your control

GitHub
======

- Typically want an authoritative copy of your Git repository somewhere.
- GitHub hosts (and backs up) Git repositories for you.
- Also provides a web interface with a litany of incredible features.
  - Compare different copies of your code
  - User-friendly "diff"s
  - Team-based access management to your projects
  - Free hosting for open-source

GitHub Definitions
==================

- **Fork** -- To clone a copy of someone else's repository into your own. May not have write permissions on the original repository, do have them on your copy.
- **Pull Request** -- To submit changes you've made in your fork of a project back to the original project. How GitHub enables contributions to open-source projects.

Git Clients
===========

- Software comes with command line interfaces
- GitHub offers a nice Mac/Windows client if you're on GitHub
- RStudio supports Git (and SVN), if installed.
  - Powerful interface if you're doing R development

***

![Git in RStudio](images/rstudio-git.png)

Automated Testing
==================================
type: section

Manual Testing Process
======================

<div class="large">1. Write some code.</div>
<div class="large">2. Try running it. Does it seem to work?</div>
<div class="indent large">(2a. Try some different input. Still work?)</div>
<div class="large">3. If yes, Great! Go back to #1.</div>
<br />
<div class="large">Works when testing a small, isolated function.</div>

Manual Testing Growing Pain
===========================
left: 40%

## What about when you grow?

- Multiple nested functions
- Change the inner-most function?
  - Test it and all ancestors...
- What about a bug in a utility function?

***

```{r, eval=FALSE}
foo <- function(x, y){
  bar(x) + y
}

bar <- function(x){
  if (x > 0){
    return(x + 14)
  }
  return (3)
}

```

Automated Testing
=================

- Formalize all the "sanity checks" you already do
- Write code that describes how you expect a function to behave
- Develop a suite of tests that cover your code
  - Know immediately if you broke anything
  - Ensure no old bug creeps back in
  - Formally document behavior of your code
  - Approach old code with confidence

Takeaway
========

```{r, echo=FALSE, fig.width=12}
x <- 1:20
notest <- (1:20)^1.5
test <- 8 + ((1:20)/3)^1.3
par(mar=c(5,5,2,2))
plot(x, notest, xlab="Complexity", ylab="Pain", type="l", lwd=2, cex.lab=2.5)
lines(x, test, col=2, lwd=2, lty=2)
legend(c("Without Testing", "With Testing"), col=1:2, x=1, y=80, lwd=4, 
       cex=2.5, lty=1:2)
```

Testing in R
============
left: 40%

We'll use the [TestThat](https://github.com/hadley/testthat) package for testing
 
 - Automated test execution when your code changes
 - Works great with packages
 - Visual reporters to summarize results of testing

***

```{r, eval=FALSE}
> test_package("shiny")
bootstrap : ........
garbage coll : ......
Shiny Input : ..1......
reactivity : ...........
tags : ...........
text : ................
URL : ..

1. Failure: Matrix converts list of lists to matrix

Error: Test failures
```

TestThat Example
================

```{r}
library(testthat)

# Define a single test
test_that("Everything works", {  
  # Define the expectations that 
  # constitute this test.
  expect_equal(2+2, 4)
  expect_true(5 > 3)
  expect_false(3 * 4 == 11)
  expect_error("r" + 4)
})

```

Hands-On
==================================
type: section

GitHub Introduction
==================================
type: sub-section

http://www.github.com

Problem
=======
left: 40%

- Often need to square numbers in R.
- Want to write a reusable function that will square numbers for us.

***

```{r, eval=FALSE}
#' Square a number
#'
#' @param x The number
#'   to square.
square <- function(x){
  # Magic here!
}

square(2)
```

```{r, echo=FALSE}
print(4)
```

Testing Example - Squaring
==========================
left: 55%

## Code

```{r}
square <- function(x){
  sq <- 0
  for (i in 1:x){
    sq <- sq + x
  }
  return(sq)
}
```

***

## Tests

```{r}
library(testthat)
expect_equal(
  square(3), 9
) # Passes

expect_equal(
  square(5), 25
) # Passes
```

Test-Driven Development (TDD)
=============================
incremental: true

If you see a bug:

<ol start="0">
<li>Document/report it (Optional)</li>
<li>Write a test that fails</li>
<li>Fix the bug</li>
<li>Show that the test now passes</li>
<li>Commit to revision control</li>
</ol>

Tests Failing
=============
left: 55%

## Code

```{r}
square <- function(x){
  sq <- 0
  for (i in 1:x){
    sq <- sq + x
  }
  return(sq)
}
```

***

## Tests

```{r, eval=FALSE}
library(testthat)
expect_equal(
  square(-2), 4
) # Fails

expect_equal(
 square(1.1),1.21
) # Fails
```


Tests Passing
=============
left: 55%

## Code

```{r}
square <- function(x){
  sq <- x * x
  return(sq)
}
```

***

## Tests

```{r}
library(testthat)
expect_equal(
  square(-2), 4
) # Passes

expect_equal(
 square(1.1), 1.21
) # Passes
```

Testing Timing
==============
left: 35%

## Code

```{r}
square <- 
function(x){
  x^2
}
```

***

## Tests

```{r}
time <- system.time({
  for (i in 1:1000000){
    square(2)
  }
})
expect_true(
  time[3] < 0.8
) # Passes

cat(time[3], "s")
```

Resources
=========

## Revision Control & Git

- [Practical strategies for branching and merging](http://nvie.com/posts/a-successful-git-branching-model/)
- [GitHub Help](https://help.github.com/)
- [Passwordless (Key-Based) GitHub Logins](https://help.github.com/articles/generating-ssh-keys)


***

## Testing in R

- [TestThat GitHub Page](https://github.com/hadley/testthat/)
- ["Testing" chapter in *Advanced R Programming*](http://adv-r.had.co.nz/Testing.html)

